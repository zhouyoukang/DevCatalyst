# 规则熵增问题与 v5.0 自律架构设计

> 状态：已实现 | 核心机制已植入 soul.md / execution-engine.md / evolve.md

## 核心问题诊断

**规则熵增** —— 信息系统的第二定律：

```
用户不断添加规则 → 短期有效 → 长期冗余矛盾 → AI 效率下降 → 用户再加规则修补 → 恶性循环
```

## 三层不可变架构

```
┌────────────────────────────────────────────┐
│  Layer 0: 内核（Kernel）                    │
│  ≤ 500 字符 | 永不修改                      │
│  仅 3 条元规则：                            │
│  1. 规则总预算 ≤ 6000 字符                  │
│  2. 新增规则必须通过变更协议                 │
│  3. AI 禁止无条件执行用户的规则修改请求       │
├────────────────────────────────────────────┤
│  Layer 1: 框架（Framework）                 │
│  ≤ 3000 字符 | 仅 /evolve 可修改            │
│  决策框架 + 执行引擎 + 安全约束              │
├────────────────────────────────────────────┤
│  Layer 2: 扩展（Extensions）                │
│  ≤ 2500 字符 | 日常可修改（受变更协议约束）   │
│  项目特定 + 用户自定义 + 实验性规则          │
└────────────────────────────────────────────┘
```

## 核心机制

### 1. 变更协议
```
用户请求 → AI 分析 → 路由决策 → 冲突检测 → 预算检查 → 实施/拒绝
```

### 2. 规则生命周期
```
用户提出 → [proposed] → Memory观察 [experimental] → 验证3+次 [validated] → 规则文件 [core] → 未触发 [deprecated]
```

### 3. 规则编译器（/evolve 升级版）
```
Phase 1: 审计 — 统计规则总量、预算使用率
Phase 2: 去重 — 检测语义重复并合并
Phase 3: 升级/降级 — experimental→validated 或 deprecated→移除
Phase 4: 压缩 — 保持语义不变前提下精简表达
Phase 5: 冲突扫描 — 检测矛盾规则
Phase 6: 输出报告 — 变更日志 + 预算使用率 + 健康评分
```

## 与 v4.0 的对比

| 维度 | v4.0 | v5.0 |
|------|------|------|
| 规则增长 | 无限制 | **预算制**（6000字符上限） |
| 用户说"加规则" | AI 直接加 | **变更协议**（路由→冲突→预算） |
| 新想法处理 | 直接固化到规则 | **默认进 Memory 观察** |
| 规则质量 | 靠人检查 | **编译器模式**（去重+冲突+压缩） |
